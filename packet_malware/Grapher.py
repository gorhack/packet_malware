import networkx as nx
import matplotlib.pyplot as plt
import PcapAnalyzer


def graphPcap(analyzedPcap):
    print("Graphing Pcap...")
    G = nx.Graph()

    _node_info = dict()
    # node_name : [node_color, node_size]
    _edge_info = dict()
    # [node1, node2] : color

    print("analyzed pcap: ".format((analyzedPcap)))

    for p in analyzedPcap:
        _ip = p.ip
        _hostname = p.hostname
        _relationships = p.relationships
        _malicious_cons = p.malicious_cons
        _malicious_files = p.malicious_files,
        _warning_level = p.warning_level

        g = nx.star_graph(0)
        g.add_node(_hostname)
        if _warning_level == 'low':
            node_color = 'b'
        elif _warning_level == 'medium':
            node_color = 'y'
        else:
            node_color = 'r'
        _node_info[_hostname] = [node_color, 8000]

        _malicious_urls = []

        for r in _malicious_cons:
            _malicious_urls.append(r.hostname)
            g.add_node(r.hostname)
            g.add_edge(_hostname, r.hostname)

            _node_info[r.hostname] = ['r', 1000]
            _edge_info[_hostname, r.hostname] = 'r'

        for r in list(set(_relationships) - set(_malicious_urls)):
            g.add_node(r)
            g.add_edge(_hostname, r)

            _node_info[r] = ['b', 1000]
            _edge_info[_hostname, r] = 'b'

        G.add_nodes_from(g.nodes())
        G.add_edges_from(g.edges())

    G.remove_node(0)
    # print(_node_info)
    _node_list = []
    _node_colors = []
    _node_sizes = []
    for k, v in _node_info.items():
        _node_list.append(k)
        _node_colors.append(v[0])
        _node_sizes.append(v[1])

    #pos = nx.spring_layout(G)
    nx.draw(G,
    #        pos,
            nodelist=_node_list,
            node_color=_node_colors,
            node_size=_node_sizes,
            edgelist=_edge_info.keys(),
            edge_color=_edge_info.values(),
            with_labels=True)
    plt.show()


def main():
    print("Graphing!")
    G = nx.Graph()
    G.add_nodes_from([1-3])
    G.add_edge(1, 2)

    nx.draw_random(G)
    nx.draw_circular(G)
    nx.draw_spectral(G)
    plt.show()


if __name__ == '__main__':
    main()
