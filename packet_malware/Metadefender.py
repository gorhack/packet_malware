import requests
import json
import api_keys


class Metadefender(object):
    def __init__(self):
        self.md_api_key = api_keys.metadefender
        self.url = 'https://hashlookup.metadefender.com/v2/hash'
        self.response = []

    def analyzeHashes(self, hashes2analyze):
        if len(hashes2analyze) == 0:
            raise ValueError("No hashes to analyze")
            return self.response

        hashes = hashes2analyze
        workingCount = hashes

        if len(workingCount) > 1000:
            workingCount = hashes[0:1000]
            hashes = hashes[1000:]
        else:
            hashes = []

        headers = {
            'apikey': self.md_api_key,
            'content-type': 'application/json'
        }

        payload = {"hash": workingCount}

        self.post_params = {
            "apikey": self.md_api_key
        }
        with requests.Session() as s:
            try:
                r = s.post(self.url,
                           headers=headers,
                           data=json.dumps(payload),
                           timeout=5)
                if r.status_code == 403:
                    raise ConnectionRefusedError('Reached max API limit, ' +
                                                 'try again later')
                elif r.status_code == requests.codes.ok:
                    parsed = json.loads(r.text)
                    print(json.dumps(parsed, indent=4))
                    # self.response += r.json()
                else:
                    raise ValueError("Invalid " +
                                     "response code: {}".format(r.status_code))
            except(requests.exceptions.RequestException) as e:
                if self.count > 5:
                        self.count = 0
                        print("Too many connection failures, " +
                              "check your Internet connection: {}".format(e))

                else:
                    print("Error sending URLs to metadefender")
                    self.count += 1
                    return self.analyzeHashes(hashes2analyze)
        if len(hashes) > 0:
            self.analyzeHashes(hashes)

if __name__ == '__main__':
    hashes = ['28fd8c8b632ef4174f7c6ecbaa5a443a', '02917ec8a42270b3f5bf9289c80e0225', '7bb5c7ab838b7caaea2dd95989e1c71e', '85105d9b4722244a536ecf6329e8761a', 'b497b179a22254a814876f77d05040eb', 'd3cc96be8cb9a96a7d8da2b1ebad2b79', '3757ff233ec8c24443afcc356ec3afcf', 'a755c37eec9bc051a2228253afb26bff', 'eb74f3bb51fddbd06656c58f7cef8052', '3d0ec778641e94fafa03c116f0649996', '5fb896224a93d11ee4728e83af88edfa', 'b10f0d7a3ab9243a6fbaa58ec947cf03', '4acf1d80244ae60df82c2edc3bfc922c', '3c75575904e21cdf4e4fa6d159f3d75d', 'b11ced65f32fedbe9bf81ef9db0f3c94', 'ad18559cd63e6a412463a82b006ee2e5', '2fec59220936825daac7a7fcd706c591', '74266345c5ca155e141ff3c32bd4b48f', 'a254d0cec411a785da01e621bf0055d1', 'a2487832954e59034b6798e6ce6913df', 'b41d6d6af41a900d9a5731ca249186c5', 'ba23883b51f5f372d28755e199785526', '95caca5ef493a24118e8245fbc13408c', 'c751e9942532d943f7ce972da4d71b63', 'e2a32cbcb01186049212e327718f2fe5', 'b860635957ed570deb2cf994bd9a4913', '9ba4ae97203099f6671d25d876c4bbc6', '1d7edec7954d39c5d0ca76b3f01d2bc1', 'bb2e9b96daec80b808281299ffa1b9d7', '1b02e7c7255e958ce2d3ebea08f26c65', '0966b152b5615a3109156485e380fb48', 'ba8baa7598309a1947728b6f1023bf22', '8b27bc96115c2d24350f0d09e6a9433f', 'e2a07e718f516374421bc68cf9864d28', '50833f94a7ce06301c654f9462427e33', 'bfecdc4692e5821cfe1173c194eaf2c1', '7399973bd871deb9bf2579fd0a68785d', '62d9f67fc21dc98088f277ba25dfcc45', '62d9f67fc21dc98088f277ba25dfcc45', 'c9e4f9d4165253ff74f61cdf6008cda5', '58238e016452ec2bac55d6674fa3c91a', 'd06824bd4f25232fcb02b1b84e37e3ee', '4b64c29a75713788bb7116d97cee41f4', '4b59c964036a5a6ba36d4cfa34968c2a', '031416fd2123cc114170494fdfc1a8a0', '3179f2255b046d5f2e9a71e365287bef', '2c381fee3e12193d17c2ed14d2cbcffa', '08239958c021f83fdf88264e60995d99', 'dff145646b2fd800adcabb3fc02b585b', '1a27531c68df91ec891a075b0832c2e8', '46c4ad65aae9e985eb1cbf50568a4977', '8c8070ba6a911bae7047f29e383da334', '79d4cf9bbd096882d3286a7606fbf2df', 'af15ecfb2df86465f853b3376a9cab77', 'b97d0966834c58d696a4988252398f43', 'f12043b77800a77361d4350eff58ea75', '115a005986dd8bb54634d203c1b3577f', '80f73f20a4c5661509bda2adb4844579', 'f1d07e01206c8597642b44a67b74d2aa', '1d4ddc39dde11c7ebed404e0c6dc0ea1', '9a7431105a58208cc3b2fc854a841401', '8a6ff7de9c5f7dc82b10b16994608721', 'a7f75b2006030c368e62fa0bbbe7b482', 'b3b3f4c49977f5489a898b0123ea4ab5', '4aa1b6ca5425f346b6a3b2c429455b00', '80b6330b9dfb7dc5cb04f36c044f7440', '282291c478df5172489a725dfe340726', 'd0ac3823dc9fa560d4986255ed1ae13f', '8817e44dfe5e7696724db7ea218f9822', '5825bfe3be0cc638fb6568ad6583c3b1', 'ba4be2b4e54d5367f8fe7214647f9934', '64ef3777ff2fa450166eb36b246cf755', '2ffe06d8a405b0c12c155a0fdb1c5179', 'b1aed1e4c6af2a018a2424796436d97d', 'da2161a56741e8e2af00c34d48d20141', 'c0ab99281bc9edd2050d8e42379bffba', '4bfdfc3bd8b07e132f6e500d3f3a35ca', '694214eea88957cbcf72642397624f4f', '4bf7567a822f4de8b543c2eea8d3188f', '8f74792852d9018901195dc373c54a36', '0f4f34ad432c5f6d42dc05241abe0164', '56b0bff508da63686a30f1b3cae1bf50', '3365f627142d034f178b563aa0767c09', '5e648a971705f9b6443883bd607ffe99', '47586d8c2ce2fe6f995629c81b2c018d', '1b96b1675c50769c968ccf041347a095', '5dee463bacb671dd252eeb2d0920dddb', '2dbdaef3f4e943e5f7f69484315bfac3', 'acf427e932fb9413700a4b8b58b41eec', 'e6611f867d63754b7a2a974fb0a0e7dc', '0fea9192727f0519148d7acd7b4acb0d', 'f1d103b9df220b6bc49011a7141dd398', 'd0fcef6b2d88dcb1a39f3128214cd62a', 'd9a037ec339381339c8576dcedf97bdc', '792e4f718d5aa3c2210ebd9ca8aacebc', 'b73bbc4b54e3198e997a0b4f13f9e304', 'db9d1abb1b2f8da809bbde52ec71ebac', '65d98e9a4fc9f5a73bb2e53e07b265c1', '8732a6660b528fadfaeb35bcf568875f', '26156c32573f430fc4454fb551ac67f2', 'd70ffa2af5e306aa5d15a1df240ce8c9', 'ed908bc498711ccaa113f5459a053e30', 'c28583b21e372c5c6b0fdf5b7e2b56b6', 'd1ef9df803b1e4ca28f841dde2349a73', '827a5132502deb3c15fd5b7be7d6708e', '7032807a2d663de1419c82d2b393211e', '25a80b5ad848d41062ea5050534ea8f0', '6f1d5f6ec798a5c8f270bac3bc801d13', 'a68cb17631958207a3771563d68beb48', '032485fb76254b28848d9296b34645d7', '4f8f2e53dfb3f50cb0a6904b6b9abc8f', '2136d7a4820a3432bd90bf655792fd0e', 'ca5595a167b2a978c1f0daca08b52569', 'a99ea11d6e1799148ce8c1ebf999455b', 'd64ab5a71be1700b90c7de2e1bd7f1c4', 'd57b2797d7c4e10e2f1b1fd72d40908d', '42b363b1c67956611eed337629bf8ca8', '284f5523aae755cb329f63c45af8f150', '28d6814f309ea289f847c69cf91194c6', '946f2af6be0d796430b590ad5ee48be5', '6631e8c0d5f07004fabff81872f10d5e', 'dd5ecd6f928fc4f988996feb5b292879', '72ec63c377b0c42ce85c3c818b91c073', '346ad754fbe0b185b33fa1d260fac6cb', '9304abaa3f9d86ff3bfeae7235796ec7', 'bffdf29e066afd2bdc21050e6f6a784d', 'a7d814e0ab655e3368488d45ff4ca75a', '2736d3368dc394ddb02751520219c744', '1275c66386489c4d801d20394b05a880', 'd12d6345543f8da16d43535fc64c7969', '769d7a5a53ca0dbe11b85874c669a599', '1ddf4c684bdadee34351507d54bba1a1', 'faf5cde30cbe43b2ea9ca25f76c984da', 'e888a52c89c1b13efcb24c83ed2cbdee', '49758749f9f7ef02489907c3cbd7c51a', 'bc22e848792fbd293ad737bc47758934', 'b61f2daeaa6d51e7ea489a0b24f3646c', 'c2a9d1318b5f8a5452bea4136cc3acc3', '753495ae26e938a00a4cfc633e6085fa', '3179f2255b046d5f2e9a71e365287bef', '36c560ad1c805798b37db87c611c5412', '8aeffbebe6f0b9651ba10dab6b417ef8', 'eb4de70cc3b42516730371c09b043d8b', 'a945fc1e4c7c533d9ea3fc6dc6d35060', '88a9feb1818b81d925d9db73d484e345', 'f3a2654aa1b790ab4a73416cf8c32e83', '25016ae3017abce61194289ffad95e59', '72f56b2004ff8ba54445668fca411a64', '31be9014d732beb01c723662bbfa5beb', '6bb4327606940ebd24b0f20660e31251', 'd70453060565886afe6b057f858644a0', 'd6967f1a4cc2378842857490b004f450', 'e91260a10be64444940b3002856a4d50', 'eb05d8d73b5b13d8d84308a4751ece96', '8ed1782ff666e2e147a4f587247f85f0', '330f8685fe0193a49ce5c66449df7cfc', 'b48f03a8f6568f309eeeb85462651515', '8b27bc96115c2d24350f0d09e6a9433f', 'fc50b59762a995c3424814f811c4c2de', '806baac8c3374bd49c173f12ba74a775', 'c92433aa3722954d9dce0633f3398407', '0ed51d79bc77f1cbdcd20cc2b8abb1e0', '011731a261de893e36b1fef98f171db1', '23de416423bf31a9caa5cebe41e4adbb', 'e70a07e7604833b38743845d8010515b', '63d06fb590789f359eb1a8dd9e8d5bcf', 'ccb46548d22233d7121b2986cf9e49d2', '58641f1ef3c930413ebe67fd25694360', '04a22536924efcec3ce9c68b13ea8d5b', 'a8950eb0771dd8295dc6b49ad5bc45ac', '325472601571f31e1bf00674c368d335', '6d7035230cfcc3565b666dc4f9fc848f', '3076ecd4646a1bc50fedea9cbb3e87bb', '7220fd9725e67e7fd25d02dd2bbbb585', '6562ca6e2bc2213aae6db9f14b53ed2f', '232f0d97e4b3f89c764ab7711aa749d8', '16762290a43f41cb1e6f99a388f89ad7', '6c11798d5f8b8741257884b5915527e8', '88b3ffe6d27815d2e76690bce84b85ae', '0aa5682e1ee99fab1e81e56ddc210083', 'fd38803a17164caad03d68499ec553ba', '6866fe721973b946b1caaf6a3d258426', 'b689750165e495f8a9b6312664317e45', '364e75647651e4dcb8edd7139da76e59', '8d736ade9194a6afa3b749f6304fb2f4', '2891f948a93a024bf1eb86a6068454a9', 'fddcb06caba11629a403ffa2b8385d92', 'df2f799a0b0b5cd9f818b73d861fd6d1', '8a2d2d2ca6d44e3ef9e2b69eed6951fe', 'a83e5af5379627024eb0bc630e0fb07e', '38ca7b8bcfe21f02b39ab7ee955c1eeb', 'fd373951a3af195dd62bbf05df656354', '6f934cd8100db640286be1ff3d110977', 'bf5cce78ce3b252931c9c1a1b1a7ab09', 'f137ee4862785a1518fb3056eccdc99b', 'c208c97845844a067d4a8f900c225847', 'a8fc7661c63e697c2b71a11b93a6fcf4', '0d198fe3117d219330ae7d1f99192bcc', 'f1e756310102b09dcbf6b40c1ec84017', 'c889d7f1e7e37c77f20c434f5e268b60', '28d6814f309ea289f847c69cf91194c6', 'ac2f52dbe1d822de3a94534c95c17da2', '7d5a4c301dcb0ddde72ee50c8230f73d', '28d6814f309ea289f847c69cf91194c6', 'ad9e0cc0d07d5e29c98518937749da78', 'd0a38fb35aa6aa7c61444317d6a9c4e4', '7a0a420092a83a8ef3824df137463657', 'ac8f7d7fbff305802f1278734e0ec3eb', '9796ed786d95606d51be9dab54fb5350', '4f95a3ef9c96b573512cab2731e14eda', 'd21444ed3b5e6ff07dca105972c31058', 'd424bdaf2571953e17cf9334b7798996', '1829274bdac8e42aee272bb95580372c', 'ca981b40cb25323d32538aeff545c235', '881054754b6144366ca1821e5ca9ecd5', '1d11b7310d20582e4c9e75fab6f209d6', '7043690a072ccba810ac9e0a53843933', '82db67170bf274bb896a554cc34f0972', 'c101630a3a7e62cd77f5c61717209cf2', '90d41df6cb0ac1d631dd4d3bc0015523', '15cfe942cdbe74fa36be3155e96fc8ff', '585efa103777700a161c9f398af7373e', '69dd69ef2b2bb38174e2944709c946dd', '569f2b02925edb1859e8bc48be3b81fe', '40c024a61240ad007f83baa476803e72', '63aee1a106560038ad21ada434731787', 'f388866636fdee084baaa8cae7493786', '4a14653994fb54ee6e580dc53729220b', 'affacb89c51db9b8b4c4d796fa65ffd9', '7fa3baaf3ffdc748e2b945b05c9a7a2d', '527e9ec3f565f8a9f4adf31930e1ed0f', '2918e8332fc0379b46211c11dac83579', 'a57849f1de691d37a7cd2665638655a9', '68ae9ef429d51e38d79040dc367b5b2d', 'b2c7d6c82281c5bd6430144b90ac013f', 'e217afd0ba2769f9f4afb4ed75408def', '0a015cf48352c1a644557e52286abc38', 'e5ad18eafaa63294795845b461418cc8', 'e449bd5b274f826eb64de66658653347', '52ac1760de063e239fa699f6c6ac8776', 'bbcb55543f0e71f8a89b7df6fc43c551', '2cfa92bb54c376a552078ef939a6afe8', '07945a6d63b053a7bb26e536179dd6fa', '5b013fbfb6bc23c5f2f776be1a5d7682', 'd47199f4b1d9b0968a83d89832d37e88', 'b347af58e433dc28cba16c74e643fa1d', '3b22e7d385cf1e80fe52643511fa5313', 'f448682889960697d5fe77f60e9ae5c1', '535bc41dfd58bdf781e20d1f3c02873c', '36580ad54919cf7ff7d6871a8bcd4a9f', '722fa0e0d509d3c353298446dde627da', 'bb159d6724224a43459a87aa1b467d8b', 'b0e12592c2ce4ff7318e1a2f938317f6', '3335108781edeb194f60e435f25b3f59', 'a26419d0097d86a097a24229d1c054fd', 'c65cfa4c22a55e94af8d3bde354c5f40', '9bcb4dfae136c268798152bc457cf4f4', 'df06b9958b47a2a151ea711bace6b5da', 'c664e667beabd979a657beac5d6ea90f', '4860c5607899a35baeb5e97431053220', '95c2c4f8f4b57800bbae502644ccfbe6', 'e152e29a97ce10c9269a18568d0360f7', '4a0929970140f78a01ac5b87fde85959', '7518aaabbfe6077df5f743b2433c6496', '18b7cb4785dd690b0bac8ae3716d4cf1', 'c372aa9345058fff6e7fbca5a2e465ca', '9f756e72eacc6b805481a49ce51c4a79', 'e851eb249d2c38d56d1b496a3112cebc', '767d6582ffc4951bc86cf592d5dfc8c1', 'ca068af657a2d0cd3076bbb27663d9f0', '824e8f588e385b1caff5c82f5a1a99a8', 'c6dc28a97a9dc3d67f043ee32f6fc3b4', 'd411bf37de7f72e98a62fc82917f50f7', '92a4d0aeede3ce110b4121342df48496', 'cd87b8014fc73bcc652a4adec4b74d00', '75f7ccbb137bc1387c3d503d9f9a24d8', 'a07751243eeec81933e55d00b00b248c', 'cd5a4d3fdd5bffc16bf959ef75cf37bc', 'cd5a4d3fdd5bffc16bf959ef75cf37bc', 'cd5a4d3fdd5bffc16bf959ef75cf37bc', '063103f65220bbcf7866dbe9255bc183', 'f03e5a3bf534f4a738bc350631fd05bd', 'e125ae742133f257fe2830e8de75c078', '44130df0715c5eaa4e438684672b8d47', '9f756e72eacc6b805481a49ce51c4a79', 'e851eb249d2c38d56d1b496a3112cebc']
    print(str(len(hashes)))
    md = Metadefender()
    md.analyzeHashes(hashes)
